# Popover组件设计

Popover包括参考元素(reference)和弹出的内容元素(content)两部分，参考元素存在界面正常DOM结构中，而弹出元素的DOM位置则不做限制，例如可以作为body元素的子元素存在。

## 触发方式

### 点击(click)触发

1. 点击参考元素时切换显示隐藏。
1. 点击内容元素时不改变显示隐藏状态。
1. 点击除了参考元素和内容元素及其后代元素的其他DOM元素，则隐藏内容元素。

取消点击事件bubble对于内容元素显隐的影响

1. 点击参考元素，无论是否取消bubble都会触发回调函数，切换显隐状态。
1. 点击参考元素子元素，交由用户代码来决定是否取消点击事件的bubble，如果不取消，点击事件传递到参考元素同样触发回调函数，切换显隐状态；如果取消点击事件bubble，则点击事件不会传递到参考元素，显隐状态不变。
1. 点击内容元素，内容元素只有在显示的时候才会触发点击事件，这时候期望保持显示状态不变，因此不需要绑定回调，同时其子元素的点击事件也不需要监听。

由于点击除了参考元素和内容元素之外的元素需要隐藏Popover，需要监听document点击事件，但是需要注意的是参考元素子元素的点击事件可能被用户取消bubble，所以无法在冒泡阶段(bubbling phase)传递给document元素，需要在捕获（capture phase）阶段监听该事件。

### 滑动(hover)触发

1. 需要同时在内容元素和content元素上监听mouseenter, mouseleave事件，来改变显隐状态。

问题
1. mouseenter/mouseleave 和 mouseover/mouseout 的选择 ？
1. 鼠标在内容元素和参考元素之间滑动的时候，由于先滑出一个元素，在滑入一个元素，整体的效果是内容元素保持显示状态，但是中间触发了两个事件，如何处理？
引入一个延迟timer，mouseleave 200ms后才关闭，如果这期间划入了Popover，则清除这个关闭的timer，

### 焦点(focus)触发

1. DOM元素需要设置tabindex不等于-1来是的内容元素能够获取焦点。
1. 焦点转移到参考元素或者内容元素的子元素时同样希望保持显示显示状态。
1. 焦点在参考元素上时，如果使用键盘快捷键（tab）顺序转移焦点，希望焦点内容顺序转移到内容元素或者内容元素后代元素上从而保持显示状态。如果内容元素及其后代元素没有任何元素内容获取焦点，则其他元素顺序获取焦点，并隐藏内容元素。 参考元素blur事件，全局只有一个焦点，是否有API能够监控焦点转移，从而知道失去焦点的元素和得到焦点的元素。
1. 点击内容元素会导致参考元素失去焦点，这时候需要保持显示状态。

focusin/focusout

1. click事件如何触发focus/blur/focusin/focusout /mousedown/mouseup/dbclick
1. css hover 如何使用dom事件实现的


### 手动(manual)触发

根据需要控制组件代表显隐状态的数据来显示或者隐藏组件，不需要绑定任何回调。

1. 切换触发方式时，能够移除之前的触发方式绑定的事件回调，并绑定新的回调。
1. 组件销毁时，清除绑定的回调。

## 指示箭头与位置偏移

arrowVisible

## DOM结构

appendToBody

## 延迟显示

## 可访问性

## 指令

## 事件
