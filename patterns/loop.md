如何处理循环逻辑

1. split loop 每个 loop 只做一件事情，分离 modifier 和 query
1. https://www.martinfowler.com/articles/refactoring-pipelines.html
